@{
    ViewData["Title"] = "遊玩遊戲";
    Layout = "~/Areas/MiniGame/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3>正在遊玩遊戲</h3>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <h4>遊戲進行中</h4>
                    <p>您的遊戲正在進行中。祝您好運！</p>
                    
                    <div class="mb-4">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>分數</h5>
                                        <p class="h3 text-primary" id="score">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>時間</h5>
                                        <p class="h3 text-success" id="time">60</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>等級</h5>
                                        <p class="h3 text-warning" id="level">1</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <button class="btn btn-primary btn-lg" onclick="startGame()">開始遊戲</button>
                        <button class="btn btn-success btn-lg" onclick="pauseGame()">暫停</button>
                        <button class="btn btn-danger btn-lg" onclick="endGame()">結束遊戲</button>
                    </div>
                    
                    <div class="mb-4">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%" id="progress"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let gameRunning = false;
let score = 0;
let timeLeft = 60;
let level = 1;

function startGame() {
    gameRunning = true;
    score = 0;
    timeLeft = 60;
    level = 1;
    updateDisplay();
    gameLoop();
}

function pauseGame() {
    gameRunning = !gameRunning;
    if (gameRunning) {
        gameLoop();
    }
}

function endGame() {
    gameRunning = false;
    // Submit score to server
    fetch('/MiniGame/MiniGame/EndGame', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ score: score, level: level })
    })
    .then(response => response.json())
    .then(data => {
        alert('遊戲結束！最終分數：' + score);
        window.location.href = '/MiniGame/MiniGame';
    });
}

function gameLoop() {
    if (!gameRunning) return;
    
    timeLeft--;
    if (timeLeft <= 0) {
        endGame();
        return;
    }
    
    updateDisplay();
    setTimeout(gameLoop, 1000);
}

function updateDisplay() {
    document.getElementById('score').textContent = score;
    document.getElementById('time').textContent = timeLeft;
    document.getElementById('level').textContent = level;
    document.getElementById('progress').style.width = ((60 - timeLeft) / 60 * 100) + '%';
}

// Simulate scoring
document.addEventListener('click', function() {
    if (gameRunning) {
        score += 10;
        if (score % 100 === 0) {
            level++;
        }
        updateDisplay();
    }
});
</script>